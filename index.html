<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>Magic Number</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
      background: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 400px;
      margin: 40px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 1.5em;
      margin-bottom: 1em;
      text-align: center;
    }
    p.result {
      font-size: 2em;
      text-align: center;
      margin: 1em 0;
      color: #007BFF;
    }
    .refresh-button {
      display: block;
      margin: 20px auto 0;
      background-color: #cccccc; /* Inactive look */
      color: #666666;
      border: none;
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 5px;
      cursor: pointer;
    }
    .refresh-button:hover {
      background-color: #bbbbbb; /* Still somewhat "inactive" on hover */
    }

    /* Animation for the magic number */
    @keyframes refreshAnimation {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.3);
      }
      100% {
        transform: scale(1);
      }
    }
    .refreshed {
      animation: refreshAnimation 0.4s ease-in-out;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Magic Number</h1>
    <p class="result" id="result">Loading...</p>
    <button
      id="refresh-button"
      class="refresh-button"
      onclick="calculateNumber()"
    ></button>
  </div>

  <script>
    // Animate the number with a bounce/scale effect
    function animateNumber() {
      const resultEl = document.getElementById('result');
      // Remove and re-add the class to retrigger the animation
      resultEl.classList.remove('refreshed');
      void resultEl.offsetWidth; // Force reflow
      resultEl.classList.add('refreshed');
    }

    // Calculate the magic number based on day and month in Israel
    function calculateNumber() {
      // Get current date in Israel timezone
      const options = {
        timeZone: 'Asia/Jerusalem',
        year: 'numeric',
        month: 'numeric',
        day: 'numeric'
      };
      const formatter = new Intl.DateTimeFormat('en-GB', options);
      const parts = formatter.formatToParts(new Date());

      // Extract day and month from the formatted date parts
      let day, month;
      for (const part of parts) {
        if (part.type === 'day') day = parseInt(part.value, 10);
        if (part.type === 'month') month = parseInt(part.value, 10);
      }

      // Perform calculation: (day * day) + month
      const result = (day * day) + month;

      // Display the result
      const resultEl = document.getElementById('result');
      resultEl.textContent = result;

      // Trigger the animation
      animateNumber();
    }

    // Countdown to next midnight in Israel
    let countdownInterval;
    function startCountdown() {
      // Clear any existing interval to avoid duplicates
      clearInterval(countdownInterval);

      // Update immediately and then every second
      updateCountdown();
      countdownInterval = setInterval(updateCountdown, 1000);
    }

    function updateCountdown() {
      // Current time in Israel
      const nowIsrael = new Date().toLocaleString("en-US", { timeZone: "Asia/Jerusalem" });
      const currentTime = new Date(nowIsrael);

      // Next midnight in Israel
      const nextMidnight = new Date(
        currentTime.getFullYear(),
        currentTime.getMonth(),
        currentTime.getDate() + 1, // next day
        0, // hour
        0, // minute
        0  // second
      );

      // Time difference in seconds
      const diff = Math.floor((nextMidnight - currentTime) / 1000);

      if (diff <= 0) {
        // It's midnight or past â€” refresh magic number, restart countdown
        calculateNumber();  // triggers animation as well
        startCountdown();
      } else {
        // Format the difference as HH:MM:SS
        const hours = Math.floor(diff / 3600);
        const minutes = Math.floor((diff % 3600) / 60);
        const seconds = diff % 60;

        const hh = hours < 10 ? '0' + hours : hours;
        const mm = minutes < 10 ? '0' + minutes : minutes;
        const ss = seconds < 10 ? '0' + seconds : seconds;

        // Update button text to show the countdown
        document.getElementById('refresh-button').textContent = `${hh}:${mm}:${ss}`;
      }
    }

    // Initial load:
    calculateNumber(); // Show the initial magic number (with animation)
    startCountdown();  // Start the timer to next day in Israel
  </script>
</body>
</html>
